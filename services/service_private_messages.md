# Сервис private_messages()


## Описание
В этой службе реализован простейший механизм обмена личными сообщениями наподобии чата.
Сообщения передаются напрямую от узла к узлу по сетевым транспортным протоколам в зашифрованном виде.
Для идентификации получателя сообщения может быть использован его IDURL адрес или никнейм -
он указывается при создании identity файла пользователя и может быть изменен в любой момент.

Автомат `nickname_holder()` предназначен для хранения и обновления никнейма пользователя в DHT сети,
его экземпляр создается при старте сервиса `private_messages()`.
Он создает запись в хэш-таблице для сопоставления никнейма и IDURL пользоватля.

Реализован простейший метод хранения таких коротких идентификаторов, но в нем реализован механизм
разрешения конфликтов имен, поскольку два разных пользователи могут указать одинаковый никнейм.
Автомат добавляет к никнейму числовой порядковый номер при записи в хэш-таблицу, но предварительно
сканирует ее и определяет наличие других таких же никнеймов, уже созданных другмими пользователями.

Для глобального поиска создается экземпляр автомата `nickname_observer()`, он сканирует
DHT сеть и возвращает список всех пользователей, которые указали заданный никнейм.
Пользователь, производящий поиск собеседника, может выбрать нужного адресата и начать переписку.

Личная переписка пользователя хранится на жестком диске в подпапке `.bitpie/messages/`.
Сервис `private_messages()` находится в разработке и его функционал будет расширен в будущем.

При выключении данного сервиса, будет удален экземпляр автомата `nickname_holder()` и
прекращен обмен личными сообщениями с другими пользователями в сети BitPie.NET.


## Зависит от
* [gateway()](services/service_gateway.md)
* [entangled_dht()](services/service_entangled_dht.md)


## Запуск автоматов
* [nickname_holder()](chat/nickname_holder.md)
* [nickname_observer()](chat/nickname_observer.md)


## Настройки сервиса
* services/private-messages/enabled - включение/выключение сервиса `private_messages()`


## Связанные файлы проекта
* [services/service_private_messages.py](services/service_private_messages.py)
* [chat/nickname_holder.py](chat/nickname_holder.py)
* [chat/nickname_observer.py](chat/nickname_observer.py)
* [chat/message.py](chat/message.py)



