# Сервис customer_patrol()


## Описание
Сетевая служба `customer_patrol()` следит за клиентами пользователя и за объемами загруженных файлов
на его жесткий диск с других узлов. 
При изменении размера выделенного пространства, отданного в сеть BitDust, производится проверка
общего объема уже использованного пространства и выполняются необходимые действия 
для контроля использования дисковых рессурсов. 

В момент старта службы, запускается автомат `customers_rejector()` - он отслеживает корректность
выделения пространства и размещения файлов на жестком диске пользователя.
В случае если клиенты используют больше пространства чем пользователь разрешил у себя забрать,
часть клиентов увольняется и пространство на диске очищается. 
В первую очередь будут уволены те клиенты, которые меньше других заполнили свои зарезервированные
хранилища.

Когда этот сетевой сервис активен, ядро клиентского ПО BitDust периодически запускает подпроцесс
`bptester`, который проверяет файлы в папке `.bitdust/customers/`. Выполняются следующие тесты
над хранимыми данными:

  + `validate` - проверка электронной подписи владельца данных
  + `update_customers` - хранимые данные принадлежат активным клиентам
  + `space_time` - объем хранимых данных не выходит за размер выделенной квоты, более ранние файлы будут удалены

При отключении службы `customer_patrol()`, будет происходить "замусоривание" диска пользователя,
настоятельно рекомендуется поддерживать ее активной все время.


## Зависит от
* [supplier()](services/service_supplier.md)


## Запуск автоматов
* [customers_rejector()](supplier/customers_rejector.md)

## Настройки сервиса
* services/customer-patrol/enabled - включение/выключение сервиса `customer_patrol()`


## Связанные файлы проекта
* [service/service_customer_patrol.py](services/service_customer_patrol.py)
* [supplier/customers_rejector.py](supplier/customers_rejector.py)
* [supplier/local_tester.py](supplier/local_tester.py)
* [main/bptester.py](main/bptester.py)



